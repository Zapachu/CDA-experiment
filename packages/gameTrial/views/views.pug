html
    head
        meta(charset="utf-8")
        meta(http-equiv='X-UA-Compatible', content='IE=edge')
        meta(name="viewport", content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no")
        meta(name='author', content='微课研')
        meta(name="description", content="微课研是社会科学领域全球领先的课程和研究管理平台。功能涵盖：被试招募, 被试库管理, 调查问卷, 课程管理, 在线实验, 推送通知, 实验定制, 博弈论实验, 报酬支付。实验经济学领域的高效工具，行为经济学研究的好帮手。管理学沙盘，心理学调查实验，等社科领域也可以适用。")
        meta(name="keywords", content="实验经济学平台, 被测试者, 被试招募, 被试库管理, 调查问卷, 课程管理, 推送通知, 实验平台, 经济学软件, 实验模型, 实验定制, 行为经济学, 实验经济学, 博弈论, 实验系统")
        title 微课研 - 实验经济学行为经济学宏观微观市场政策测试招募问卷调查在线实验教学研究平台
        style.
            html, body, div, span, applet, object, iframe,
            h1, h2, h3, h4, h5, h6, p, blockquote, pre,
            a, abbr, acronym, address, big, cite, code,
            del, dfn, em, img, ins, kbd, q, s, samp,
            small, strike, strong, sub, sup, tt, var,
            b, u, i, center,
            dl, dt, dd, ol, ul, li,
            fieldset, form, label, legend,
            table, caption, tbody, tfoot, thead, tr, th, td,
            article, aside, canvas, details, embed,
            figure, figcaption, footer, header, hgroup,
            menu, nav, output, ruby, section, summary,
            time, mark, audio, video {
                margin: 0;
                padding: 0;
                border: 0;
                font-size: 100%;
                font: inherit;
                vertical-align: baseline;
            }

            /* HTML5 display-role reset for older browsers */
            article, aside, details, figcaption, figure,
            footer, header, hgroup, menu, nav, section {
                display: block;
            }

            body {
                line-height: 1;
            }

            ol, ul {
                list-style: none;
            }

            blockquote, q {
                quotes: none;
            }

            blockquote:before, blockquote:after,
            q:before, q:after {
                content: '';
                content: none;
            }

            table {
                border-collapse: collapse;
                border-spacing: 0;
            }
        style.
            body {
                background-color: #eff3f5;
            }
            .header {
                overflow: hidden;
                position: relative;
            }    
            .header > img {
                width: 100%;
            }
            .header > .topBar {
                    position: absolute;
                    z-index: 2;
                    top: 0px;
                    left: 0;
                    width: 100%;
                    height: 60px;
                    padding: 0 18.75%;
                    box-sizing: border-box;
                    display: flex;
                    align-items: center;
                    background-color: rgba(0, 0, 0, 0.6); 
            }
            .header > .topBar > .logo {
                    cursor: pointer;
                    width: 28px;
                    height: 28px;
                    margin-right: 9px;
            }
            .header > .topBar > .title {
                    cursor: pointer;
                    color: #1C8CFF;
                    font-size: 18px;
            }
            @media screen and (max-width: 1020px) {
                .header > .topBar{
                    padding: 0;
                    padding-left: 3%;
                }
                 .header > img{
                    width: 160%;
                    position: relative;
                    left: 50%;
                    transform: translateX(-50%);
                }
            }
             @media screen and (max-width: 800px) {
                .header > .topBar{
                    padding-left: 3%;
                }
                 .header > img{
                    width: 320%;
                    left: -60%;
                    transform: none;
                }
            }
           
            .list {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                justify-content: center;
                width: 1020px;
                margin: 60px auto;
            }
            .list > .card {
                border-radius: 3.5%;
                box-sizing: border-box;
                overflow: hidden;
                margin-bottom: 38px;
            }
            
            
            .list > .card:hover {
                position: relative;
                top: -5px;
                cursor: pointer;
                box-shadow: 0 -3px 10px #cbcfd1;
            }
            .list > .card:hover > .info{
                background-color: white;
            }
            .list > .card + .card{
                margin-left: 12px;
            }
             .list > .card > img{
                width: 280px;
                height: 210px;
            }
            @media screen and (max-width: 1020px) {
                .list {
                    width: 100%;
                }
            }
            .list > .card > .info {
                padding: 10px 3px;
            }
            .list > .card > .info > .name {
                color: #34495E;
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 9px;
            }
            .list > .card > .info > .statistics {
                color: #999999;
                font-size: 12px;
                display: flex;
                align-items: center;
            }
            .list > .card > .info > .statistics > img{
                width: 27px;
                margin-right: 18px;
            }
            .list > .card > .info > .statistics > .count{
            }
            .footer {
                background:rgba(37,49,135,1);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                padding: 16px 10px 12px;
            }
            .footer > .qrcode {
                display: flex;
                flex-direction: column;
                align-items: center;
               
            }
            .footer > .qrcode > img {
                padding: 4px;
                background-color: white;
                width: 46px;
                height: 46px;
                margin-bottom: 10px;
            }
              .footer > .qrcode > label {
            }
            .footer > .content > .top{
                display: flex;
                align-items: center;
                justify-content: space-around;
                width: 560px;
                margin-bottom: 20px;
            }
            .footer > .content > .top  > *{
                cursor: pointer;
            }
            .footer > .content > .bottom{
                text-align: center;
            }

            @media screen and (max-width: 740px) {
                .footer {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                }
                .footer > .content > .top{
                    width: 100%;
                }
                .footer > .qrcode {
                    order: -1;
                    margin-bottom: 24px;
                }
            }
        style
            include login/style.css
        style
            include modal/modal.css
        style
            include message/style.css
    body
        include  login/html
        div.header
            div.topBar
                img(src="https://qiniu0.anlint.com/image/logo/0722.jpg" class="logo")
                span.title="微课研"
            img(src=`${rootname}/static/banner.png`)
        div.list
            each gameObj in gameList
                div.card(data-type=`${gameObj.type}`)
                    img(src=`${gameObj.img}`)
                    div.info
                        h3.name=`${gameObj.name}`
                        div.statistics
                            img(src=`${rootname}/static/join_icon.png`)
                            span.count=`${gameObj.playerCount}`
        div.footer
            div.content
                div.top
                    span="了解我们"
                    span="加入我们"
                    span="服务条款"
                    span="服务方案"
                    span="定制服务"
                div.bottom="Copyright@2018 微课研 鄂ICP备14008767号-3"
            div.qrcode
                img(src="https://qiniu1.anlint.com/v2/img/qrcode.jpg")
                span.label="关注公众号了解更多详情"
        script(type="text/javascript" src="https://qiniu1.anlint.com/js/jquery.min.js")
        script(type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js")
        script
            include  login/script.js
        script
            include  modal/modal.js
        script
            include  message/script.js    
        script.
            function initWx () {
                 if(navigator.userAgent.toLowerCase().includes('micromessenger')) {
                    const gameListStr = '!{JSON.stringify(gameList)}'
                    const gameList = JSON.parse(gameListStr) || []
                    $.ajax({
                        type: 'GET',
                        url: "/wechat/jssdk?url=" + encodeURIComponent(window.location.href),
                        success: function ({err, msg}) {
                            if (err !== 0) {
                                return console.error(msg)
                            }
                            wx.config({
                                debug: false,
                                appId: msg.appId,
                                timestamp: msg.timestamp,
                                nonceStr: msg.nonceStr,
                                signature: msg.signature,
                                jsApiList: [ 'updateAppMessageShareData', 'updateTimelineShareData ' ]
                            })

                            wx.ready(function () {
                                const defaultObj = {
                                    title: '微课研-体验互动实验，感受经济学魅力',
                                    link: location.href,
                                    imgUrl: gameList.length ? location.href.replace(/\/$/, '') + gameList[0].img : ''
                                }
                                wx.updateTimelineShareData(defaultObj)
                                wx.updateAppMessageShareData(defaultObj)
                            })
                        }
                    })
                }

            }

            window.onload =function () {
                var inWx = /micromessenger/.test(navigator.userAgent.toLowerCase())
                var isLogin = !{isLogin};
                var _csrf = '!{_csrf}'
                var loginBox = LoginInit(_csrf, null, null, handleRedirect);
                var aimGameType = ''
                var namespace = '!{namespace}'
                function handleRedirect () {
                    nowUrl = location.href.replace(/\/$/, '')
                    location.href = nowUrl + '/game/' + aimGameType
                }
                initWx()
                $('.card').click(function (e) {
                    var type = $(this).attr('data-type')
                    aimGameType = type
                    if (!isLogin) {
                        if (inWx) {
                            location.href = namespace + '/account/wxlogin?redirect=' + encodeURI(location.href)
                            return
                        }
                        message.warn('请先登录')
                        loginBox.show(e)
                    } else {
                        handleRedirect()
                    }
                })
                $('.topBar .logo, .topBar .title ').click(function () {
                    location = 'https://www.ancademy.org/'
                })
            }    